# SentinelCBContent

Automated Microsoft Sentinel content — detections, workbooks, and hunting queries generated by ClawdBot based on the latest threat intelligence.

Auto-updated daily at 08:00 UTC from CISA KEV, SANS ISC, Microsoft Security Blog, and other sources.

---

## Structure

```
├── Detections/       # KQL analytic rules (YAML - Sentinel-compatible)
├── Workbooks/        # Azure Sentinel workbook ARM templates (JSON)
├── Hunting/          # KQL hunting queries
└── .github/
    └── workflows/
        ├── validate.yml   # CI: validates YAML structure + unique IDs
        └── deploy.yml     # CD: deploys to Sentinel on push to main
```

## Testing the Content

### Option 1 — Quick KQL Validation (No Sentinel needed)
1. Open [Azure Log Analytics Demo](https://portal.azure.com/#blade/Microsoft_Azure_Monitoring_Logs/DemoLogsBlade) (free, no subscription needed)
2. Copy/paste any `query:` block from the YAML detection files
3. Run it to validate syntax — you'll get empty results (demo data) but syntax errors will show

### Option 2 — GitHub Actions CI (Automatic)
Every push to `main` triggers `.github/workflows/validate.yml` which:
- Validates YAML structure and required fields
- Checks all detection IDs are valid UUIDs
- Checks for duplicate IDs across the repo

### Option 3 — Deploy to Sentinel (Full test with real data)
Add these GitHub secrets to the repo:

| Secret | Value |
|--------|-------|
| `AZURE_CREDENTIALS` | Output of `az ad sp create-for-rbac --role Contributor --scopes /subscriptions/<id>` |
| `AZURE_SUBSCRIPTION_ID` | Your Azure subscription ID |
| `AZURE_RESOURCE_GROUP` | Resource group containing your Sentinel workspace |
| `SENTINEL_WORKSPACE` | Log Analytics workspace name |

Once set, pushing to `main` auto-deploys via `.github/workflows/deploy.yml`.

### Option 4 — Manual PowerShell Deployment
```powershell
# Install module
Install-Module -Name Az.SecurityInsights -Force

# Connect
Connect-AzAccount

# Deploy a single rule
$rule = Get-Content 'Detections/RoundCube-Webmail-Exploitation-CVE-2025-68461-49113.yaml' | ConvertFrom-Yaml
New-AzSentinelAlertRule -ResourceGroupName "MyRG" -WorkspaceName "MySentinel" `
  -Kind Scheduled `
  -DisplayName $rule.name `
  -Query $rule.query `
  -Severity $rule.severity `
  -QueryFrequency (New-TimeSpan -Hours 1) `
  -QueryPeriod (New-TimeSpan -Hours 1)
```

---

## Sources Monitored

- [CISA Known Exploited Vulnerabilities (KEV)](https://www.cisa.gov/known-exploited-vulnerabilities-catalog)
- [SANS Internet Storm Center](https://isc.sans.edu)
- [Microsoft Security Blog](https://www.microsoft.com/en-us/security/blog/)
- MITRE ATT&CK updates
- Vendor threat intelligence

## Content Format

Detections follow the [Azure Sentinel YAML analytic rule format](https://github.com/Azure/Azure-Sentinel) with:
- Valid UUID `id`
- MITRE ATT&CK `tactics` and `relevantTechniques`
- `entityMappings` for incident enrichment
- Source references in `description`

---

*Content generated by ClawdBot — an automated threat intel pipeline running on OpenClaw.*
