{
  "id": "e3e866b0-6621-47c4-b98b-4b498a39397e",
  "name": "Hunting - Zimbra ZCS WebEx Zimlet SSRF Exploitation (CVE-2020-7796)",
  "description": "Proactive threat hunt for indicators of Zimbra Collaboration Suite (ZCS) SSRF exploitation via the WebEx zimlet JSP endpoint (CVE-2020-7796). The vulnerable endpoint (/zimlet/com_zimbra_webex/httpPost.jsp) allows unauthenticated attackers to cause the Zimbra server to make arbitrary HTTP requests to internal infrastructure, cloud metadata services (IMDS), or attacker-controlled systems. This hunt covers: (1) all access to the vulnerable endpoint, (2) Zimbra Java process IMDS/internal connections indicating SSRF success, (3) mass internal scanning patterns from the Zimbra server, and (4) credential-related process activity on the Zimbra server post-SSRF. Lookback: 30 days.",
  "tactics": [
    "InitialAccess",
    "Discovery",
    "CredentialAccess"
  ],
  "techniques": [
    "T1190",
    "T1046",
    "T1552"
  ],
  "requiredDataConnectors": [
    "MicrosoftDefenderForEndpoint",
    "CEF"
  ],
  "query": "// Hunt: Zimbra ZCS WebEx Zimlet SSRF (CVE-2020-7796)\n// Lookback: 30 days\nlet lookback = 30d;\n// --- Section 1: All requests to the vulnerable zimlet endpoint ---\n// ANY access to this path is suspicious â€” flag it regardless of payload.\nlet Zimbra_EndpointAccess = union isfuzzy=true (\n    CommonSecurityLog\n    | where TimeGenerated >= ago(lookback)\n    | where RequestURL has \"/zimlet/com_zimbra_webex/httpPost.jsp\"\n    | extend ResponseCode = tostring(EventOutcome)\n    | extend HasSSRFPayload = RequestURL has_any (\n        \"169.254.169.254\", \"metadata.google\", \"metadata.azure\",\n        \"localhost\", \"127.0.0.\", \"0.0.0.0\",\n        \"file://\", \"dict://\", \"gopher://\"\n      )\n    | project TimeGenerated, SourceIP, DestinationIP, RequestURL,\n              RequestMethod, ResponseCode, HasSSRFPayload\n    | extend HuntSection = \"1-ZimletEndpoint\"\n);\n// --- Section 2: Zimbra Java process connecting to IMDS or internal addresses ---\n// Successful SSRF: Zimbra server reaches out to metadata service or internal hosts.\nlet Zimbra_IMDSAccess = DeviceNetworkEvents\n    | where TimeGenerated >= ago(lookback)\n    | where InitiatingProcessFileName in~ (\"java.exe\", \"javaw.exe\")\n    | where InitiatingProcessCommandLine has_any (\n        \"zimbra\", \"ZCS\", \"mailboxd\", \"jetty\", \"zimlet\"\n      )\n    | extend IsMDSHit = RemoteIP in (\"169.254.169.254\", \"fd00:ec2::254\", \"100.100.100.200\")\n    | extend IsInternalHit = ipv4_is_private(RemoteIP)\n    | where IsMDSHit or (IsInternalHit and RemotePort in (22, 3389, 5985, 8080, 9200, 2379, 6443))\n    | extend AccountName = InitiatingProcessAccountName\n    | project TimeGenerated, DeviceName, AccountName, InitiatingProcessFileName,\n              RemoteIP, RemotePort, RemoteUrl, IsMDSHit, IsInternalHit\n    | extend HuntSection = \"2-IMDS_or_InternalSSRF\";\n// --- Section 3: Internal network scanning burst from Zimbra server ---\n// SSRF-driven recon: many distinct internal IPs contacted in short window.\nlet Zimbra_InternalScan = DeviceNetworkEvents\n    | where TimeGenerated >= ago(lookback)\n    | where InitiatingProcessFileName in~ (\"java.exe\", \"javaw.exe\")\n    | where InitiatingProcessCommandLine has_any (\"zimbra\", \"ZCS\", \"mailboxd\")\n    | where ipv4_is_private(RemoteIP)\n    | summarize\n        UniqueIPs = dcount(RemoteIP),\n        SampleIPs = make_list(RemoteIP, 10),\n        Ports = make_set(RemotePort)\n        by DeviceName, bin(TimeGenerated, 5m)\n    | where UniqueIPs >= 5\n    | extend AccountName = \"\"\n    | project TimeGenerated, DeviceName, AccountName, UniqueIPs, SampleIPs, Ports\n    | extend HuntSection = \"3-InternalScanBurst\";\n// --- Section 4: Credential access post-SSRF on Zimbra server ---\n// Attacker using SSRF to reach IMDS and steal credentials.\n// Also check for /etc/passwd, /etc/shadow access via file:// scheme.\nlet Zimbra_CredAccess = DeviceProcessEvents\n    | where TimeGenerated >= ago(lookback)\n    | where InitiatingProcessFileName in~ (\"java.exe\", \"javaw.exe\", \"bash\", \"sh\")\n    | where InitiatingProcessCommandLine has_any (\"zimbra\", \"ZCS\", \"mailboxd\")\n    | where ProcessCommandLine has_any (\n        \"/etc/passwd\", \"/etc/shadow\", \"id_rsa\", \"id_ecdsa\",\n        \"curl 169.254\", \"wget 169.254\",\n        \".aws/credentials\", \"boto\", \"azure-cli\"\n      )\n    | project TimeGenerated, DeviceName, AccountName, InitiatingProcessFileName,\n              ProcessCommandLine\n    | extend HuntSection = \"4-CredentialAccess\";\n// Union all hunt sections\nunion Zimbra_EndpointAccess, Zimbra_IMDSAccess, Zimbra_InternalScan, Zimbra_CredAccess\n| extend HuntSection = coalesce(HuntSection, \"unknown\")\n| sort by TimeGenerated desc\n| project TimeGenerated, HuntSection, DeviceName, AccountName,\n          SourceIP, RemoteIP, RemotePort, UniqueIPs,\n          RequestURL, ProcessCommandLine, InitiatingProcessFileName",
  "source": "https://nvd.nist.gov/vuln/detail/CVE-2020-7796",
  "references": [
    "https://wiki.zimbra.com/wiki/Zimbra_Releases/8.8.15/P7",
    "https://nvd.nist.gov/vuln/detail/CVE-2020-7796",
    "https://www.cisa.gov/known-exploited-vulnerabilities-catalog"
  ],
  "created": "2026-02-23",
  "version": "1.0.0"
}
