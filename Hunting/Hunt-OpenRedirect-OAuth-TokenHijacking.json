{
  "id": "ba6d144f-d8ac-4a6d-977d-4e402f21b791",
  "name": "Hunt: Open Redirect Scanning and OAuth Token Hijacking",
  "description": "Hunts for active exploitation of open redirect vulnerabilities, including the scan campaign reported by SANS ISC on 2026-02-24 originating from 89.248.168.239 (AS202425, IP Volume, bulletproof hosting).\n\nOpen redirects allow an attacker to craft a link to a trusted domain that immediately bounces the victim to a malicious URL. When the trusted domain is an OAuth redirect_uri allowlist entry, the attacker can redirect OAuth authorization codes or access tokens to their own endpoint — a technique increasingly used for account takeover without needing stolen passwords.\n\nThis hunt covers three scenarios:\n1. Reconnaissance: External scanning for open redirect endpoints (/redirect, /goto, /away, /continue, /jump)\n2. OAuth token theft: OAuth redirect_uri manipulation via open redirect chain\n3. Phishing delivery: Redirect from trusted corporate domain to external malicious URL\n\nReferences:\n  - SANS ISC Diary: https://isc.sans.edu/diary/32394\n  - OWASP: https://cheatsheetseries.owasp.org/cheatsheets/Unvalidated_Redirects_and_Forwards_Cheat_Sheet.html\n  - AS202425 (IP Volume) abuse: https://www.nytimes.com/interactive/2019/12/22/us/child-sex-abuse-websites-shut-down.html",
  "tactics": ["InitialAccess", "CredentialAccess", "Collection"],
  "relevantTechniques": ["T1190", "T1539", "T1550"],
  "requiredDataConnectors": [
    {
      "connectorId": "CEF",
      "datatypes": ["CommonSecurityLog"]
    },
    {
      "connectorId": "AzureActiveDirectory",
      "datatypes": ["SigninLogs", "AADNonInteractiveUserSignInLogs"]
    },
    {
      "connectorId": "Office365",
      "datatypes": ["OfficeActivity"]
    }
  ],
  "query": "// ============================================================\n// Hunt 1: Known scanner IP and open redirect endpoint probing\n// Detects requests from 89.248.168.239 or any source probing\n// classic open redirect path patterns across web infrastructure.\n// ============================================================\nlet KnownScannerIPs = dynamic([\"89.248.168.239\"]);\nlet OpenRedirectPaths = dynamic([\n    \"/redirect\", \"/continue\", \"/away\", \"/goto\", \"/jump\",\n    \"/out\", \"/exit\", \"/link\", \"/bounce\", \"/forward\",\n    \"/url\", \"/r\"\n]);\nlet OpenRedirectParams = dynamic([\n    \"?url=\", \"?redirect=\", \"?next=\", \"?continue=\", \"?goto=\",\n    \"?away=\", \"?jump=\", \"?link=\", \"?return=\", \"?returnUrl=\",\n    \"?returnTo=\", \"?back=\", \"?dest=\", \"?destination=\"\n]);\n// Sub-query A: Direct scanner hits\nlet ScannerActivity = CommonSecurityLog\n    | where TimeGenerated > ago(24h)\n    | where SourceIP in (KnownScannerIPs)\n        or RequestURL has_any (OpenRedirectPaths)\n        or RequestURL has_any (OpenRedirectParams)\n    | extend ScanIndicator = case(\n        SourceIP in (KnownScannerIPs), \"Known AS202425 (IP Volume) scanner IP\",\n        RequestURL has_any (OpenRedirectPaths) and RequestURL has_any (OpenRedirectParams),\n            \"Open redirect path + parameter probe\",\n        \"Redirect parameter probe\"\n    )\n    | extend ExternalTarget = extract(@\"[?&](?:url|redirect|next|continue|goto|away|jump|link|return|returnUrl|returnTo|back|dest|destination)=([^&]+)\", 1, RequestURL)\n    | where not(ExternalTarget matches regex @\"^(?:https?://)?((?:[a-zA-Z0-9-]+\\.)+(?:your-domain\\.com))\")  // adjust to your org domain\n    | project TimeGenerated, SourceIP, DestinationIP, RequestURL, RequestMethod,\n              EventOutcome, ScanIndicator, ExternalTarget;\n// ============================================================\n// Hunt 2: OAuth redirect_uri abuse — auth codes redirected externally\n// Detects OAuth flows where the redirect_uri resolves to an\n// external/unexpected destination (possible token theft via open redirect).\n// ============================================================\nlet OAuthRedirectAbuse = AADNonInteractiveUserSignInLogs\n    | where TimeGenerated > ago(24h)\n    | where ResultType == 0  // Successful sign-ins\n    | extend RedirectUri = tostring(parse_json(tostring(AuthenticationDetails))[0].authenticationMethod)\n    | where isnotempty(tostring(parse_json(AdditionalDetails)[\"redirectUri\"]))\n    | extend RedirectTarget = tostring(parse_json(AdditionalDetails)[\"redirectUri\"])\n    | where RedirectTarget has_any (\"http://\", \"https://\")\n    // Flag redirect URIs pointing to non-Microsoft, non-corporate domains\n    | where not(RedirectTarget has_any (\n        \"login.microsoftonline.com\",\n        \"login.microsoft.com\",\n        \"graph.microsoft.com\",\n        \"portal.azure.com\",\n        \"localhost\", \"127.0.0.1\"\n      ))\n    | extend ScanIndicator = \"OAuth redirect_uri to unexpected external domain\"\n    | project TimeGenerated, UserPrincipalName, IPAddress, AppDisplayName,\n              RedirectTarget, ScanIndicator, Location, RiskLevelDuringSignIn;\n// ============================================================\n// Hunt 3: Sign-in anomaly following redirect probe\n// Correlates redirect scanning with subsequent unusual sign-ins\n// from the same source — suggesting token theft was used.\n// ============================================================\nlet ScannerIPs = ScannerActivity\n    | summarize by SourceIP;\nlet PostScanSignins = SigninLogs\n    | where TimeGenerated > ago(24h)\n    | where ResultType == 0\n    | where IPAddress in (ScannerIPs)\n    | extend ScanIndicator = \"Sign-in from known open redirect scanner IP after probe activity\"\n    | project TimeGenerated, UserPrincipalName, IPAddress, AppDisplayName,\n              Location, RiskLevelDuringSignIn, ScanIndicator;\n// ============================================================\n// Hunt 4: W3CIISLog / AzureDiagnostics — redirect probes on Azure App Services\n// ============================================================\nlet AppServiceRedirectProbe = AzureDiagnostics\n    | where TimeGenerated > ago(24h)\n    | where Category == \"AppServiceHTTPLogs\"\n    | where csUriStem_s has_any (OpenRedirectPaths)\n        or csUriQuery_s has_any (OpenRedirectParams)\n    | extend ExternalTarget = extract(@\"(?:url|redirect|next|continue|goto|away|jump)=([^&\\s]+)\", 1, csUriQuery_s)\n    | where isnotempty(ExternalTarget)\n    | extend ScanIndicator = case(\n        cIp_s in (KnownScannerIPs), \"Known scanner probing Azure App Service redirect endpoint\",\n        \"Redirect parameter probe on Azure App Service\"\n    )\n    | project TimeGenerated, _ResourceId, cIp_s, csMethod_s, csUriStem_s,\n              csUriQuery_s, ExternalTarget, scStatus_s, ScanIndicator;\n// Union all hunt outputs\nunion ScannerActivity, OAuthRedirectAbuse, PostScanSignins, AppServiceRedirectProbe\n| sort by TimeGenerated desc",
  "version": "1.0.0",
  "tags": [
    {"name": "tactics", "value": "InitialAccess,CredentialAccess,Collection"},
    {"name": "techniques", "value": "T1190,T1539,T1550"},
    {"name": "source", "value": "SANS-ISC-2026-02-24"},
    {"name": "threat", "value": "Open Redirect OAuth Token Hijacking"},
    {"name": "ioc", "value": "89.248.168.239"}
  ]
}
