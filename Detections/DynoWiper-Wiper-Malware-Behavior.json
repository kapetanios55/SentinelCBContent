{
  "name": "Wiper Malware Behavior - Mass File Deletion and Drive Corruption (DynoWiper / Sandworm TTPs)",
  "description": "Detects behavior consistent with wiper malware such as DynoWiper, attributed to Russian APT Sandworm, used in attacks against Polish energy companies in late December 2025. The malware enumerates drives, recursively corrupts files by overwriting with random bytes, then deletes files before forcing a system reboot. This rule looks for high-volume file deletion events, access token manipulation for shutdown privileges, and suspicious process shutdown commands â€” key IOB (indicators of behavior) for wiper activity. MITRE: T1485 (Data Destruction), T1529 (System Shutdown/Reboot), T1134 (Access Token Manipulation), T1083 (File and Directory Discovery).",
  "severity": "High",
  "tactics": ["Impact", "DefenseEvasion", "PrivilegeEscalation"],
  "techniques": ["T1485", "T1529", "T1134", "T1083", "T1222"],
  "requiredDataConnectors": ["SecurityEvents", "MicrosoftDefenderForEndpoint"],
  "query": "// Wiper Malware Behavior Detection (DynoWiper / Sandworm TTPs)\n// Looks for mass file deletion, shutdown privilege escalation, and forced reboot\nlet timeframe = 1h;\nlet mass_delete_threshold = 100;\n// 1. Mass File Deletion via SecurityEvent (Windows File System Auditing)\nlet MassFileDeletion = SecurityEvent\n| where TimeGenerated >= ago(timeframe)\n| where EventID == 4663  // Object Access\n| where ObjectType == 'File'\n| where AccessMask has '0x10000'  // DELETE permission\n| summarize DeleteCount = count(), Files = make_set(ObjectName, 20), FirstSeen = min(TimeGenerated)\n    by Computer, Account, ProcessName\n| where DeleteCount >= mass_delete_threshold\n| extend BehaviorType = 'MassFileDeletion', RiskScore = 80;\n// 2. Token Manipulation for Shutdown Privilege (SeShutdownPrivilege)\nlet ShutdownPrivilegeEscalation = SecurityEvent\n| where TimeGenerated >= ago(timeframe)\n| where EventID == 4703  // User Right Adjusted\n| where PrivilegeList has 'SeShutdownPrivilege'\n| project TimeGenerated, Computer, Account, ProcessName, EventID\n| extend BehaviorType = 'ShutdownPrivilegeEnabled', RiskScore = 60;\n// 3. Forced Shutdown Commands\nlet ForcedShutdown = SecurityEvent\n| where TimeGenerated >= ago(timeframe)\n| where EventID == 4688  // Process Creation\n| where CommandLine has_any ('shutdown /r /f', 'shutdown -r -f', 'ExitWindowsEx', 'InitiateSystemShutdown')\n   or (NewProcessName has 'shutdown.exe' and CommandLine has '/f')\n| project TimeGenerated, Computer, Account, CommandLine, NewProcessName\n| extend BehaviorType = 'ForcedShutdown', RiskScore = 70;\n// 4. MDE - High volume file modification/deletion (Defender for Endpoint)\nlet MDEWiperBehavior = DeviceFileEvents\n| where TimeGenerated >= ago(timeframe)\n| where ActionType in ('FileDeleted', 'FileModified')\n| where not(FolderPath has_any ('system32', 'windows', 'Program Files', 'Temp', 'RecycleBin', '$Recycle.Bin', 'Boot', 'PerfLogs', 'AppData', 'Documents and Settings'))\n| summarize FileCount = count(), UniqueExtensions = dcount(tolower(tostring(split(FileName, '.')[-1]))), \n    Files = make_set(FileName, 10), FirstSeen = min(TimeGenerated)\n    by DeviceName, InitiatingProcessFileName, InitiatingProcessAccountName\n| where FileCount >= mass_delete_threshold\n| extend BehaviorType = 'MDEMassFileModification', RiskScore = 85;\n// Combine signals\nMassFileDeletion\n| project TimeGenerated = FirstSeen, Host = Computer, Account, Process = ProcessName, BehaviorType, RiskScore, Details = tostring(Files)\n| union (\n    ShutdownPrivilegeEscalation | project TimeGenerated, Host = Computer, Account, Process = ProcessName, BehaviorType, RiskScore, Details = ''\n)\n| union (\n    ForcedShutdown | project TimeGenerated, Host = Computer, Account, Process = NewProcessName, BehaviorType, RiskScore, Details = CommandLine\n)\n| union (\n    MDEWiperBehavior | project TimeGenerated = FirstSeen, Host = DeviceName, Account = InitiatingProcessAccountName, Process = InitiatingProcessFileName, BehaviorType, RiskScore, Details = tostring(Files)\n)\n| summarize Behaviors = make_set(BehaviorType), MaxRiskScore = max(RiskScore), FirstSeen = min(TimeGenerated), LastSeen = max(TimeGenerated)\n    by Host, Account\n| extend CombinedRisk = iff(array_length(Behaviors) >= 2, MaxRiskScore + 15, MaxRiskScore)\n| where CombinedRisk >= 70\n| sort by CombinedRisk desc",
  "queryFrequency": "PT1H",
  "queryPeriod": "PT1H",
  "triggerOperator": "GreaterThan",
  "triggerThreshold": 0,
  "entityMappings": [
    {
      "entityType": "Host",
      "fieldMappings": [{ "identifier": "HostName", "columnName": "Host" }]
    },
    {
      "entityType": "Account",
      "fieldMappings": [{ "identifier": "Name", "columnName": "Account" }]
    }
  ],
  "incidentConfiguration": {
    "createIncident": true,
    "groupingConfiguration": {
      "enabled": true,
      "reopenClosedIncident": false,
      "lookbackDuration": "PT5H",
      "matchingMethod": "Selected",
      "groupByEntities": ["Host"]
    }
  },
  "source": "https://isc.sans.edu/diary.html",
  "references": [
    "https://www.welivesecurity.com/en/eset-research/dynowiper-update-technical-analysis-attribution/",
    "https://cert.pl/uploads/docs/CERT_Polska_Energy_Sector_Incident_Report_2025.pdf",
    "https://attack.mitre.org/techniques/T1485/"
  ],
  "sha256_ioc": "835b0d87ed2d49899ab6f9479cddb8b4e03f5aeb2365c50a51f9088dcede68d5",
  "created": "2026-02-20",
  "version": "1.0.0"
}
