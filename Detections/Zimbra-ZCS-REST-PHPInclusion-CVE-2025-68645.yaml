id: 1e4fc413-fb79-4c65-b0ba-175540347300
name: Zimbra Collaboration Suite PHP Remote File Inclusion via REST Endpoint (CVE-2025-68645)
description: |
  Detects exploitation of CVE-2025-68645, a PHP remote file inclusion vulnerability in Synacor
  Zimbra Collaboration Suite (ZCS). Attackers craft requests to the /h/rest endpoint to influence
  internal request dispatching, allowing arbitrary file inclusion from the WebRoot directory.
  Successful exploitation may lead to remote code execution and full server compromise.

  Note: This is a different vulnerability from CVE-2020-7796 (WebEx Zimlet SSRF). CVE-2025-68645
  targets the /h/rest endpoint's file inclusion logic, not the WebEx Zimlet JSP.

  CISA KEV added: 2026-01-22. Due: 2026-02-12.

  Detection approach:
  - CommonSecurityLog: HTTP requests to /h/rest with suspicious path traversal or file inclusion patterns
  - Syslog: Zimbra process errors indicative of file inclusion abuse
  - DeviceProcessEvents: Zimbra Java processes spawning OS shells (post-exploitation)

severity: High
status: Available
requiredDataConnectors:
  - connectorId: CommonSecurityLog
    dataTypes:
      - CommonSecurityLog
  - connectorId: Syslog
    dataTypes:
      - Syslog
  - connectorId: MicrosoftDefenderAdvancedThreatProtection
    dataTypes:
      - DeviceProcessEvents

queryFrequency: 1h
queryPeriod: 1h

triggerOperator: gt
triggerThreshold: 0

tactics:
  - InitialAccess
  - Execution

relevantTechniques:
  - T1190
  - T1059

query: |
  // CVE-2025-68645: Zimbra ZCS PHP Remote File Inclusion via /h/rest endpoint
  // Branch 1: CommonSecurityLog — HTTP requests targeting the vulnerable /h/rest endpoint
  let ZimbraRESTAbuse = union isfuzzy=true (
    CommonSecurityLog
    | where TimeGenerated > ago(1h)
    | where DeviceProduct has_any ("Zimbra", "ZCS") or DestinationPort in (80, 443, 8080, 7071)
    | where RequestURL has "/h/rest"
       and (
           // Path traversal attempts
           RequestURL has_any ("../", "..%2F", "..%5C", "%2e%2e")
           // PHP wrapper injection
           or RequestURL has_any ("php://", "file://", "expect://", "data://", "zip://")
           // Suspicious file references that would map to WebRoot
           or RequestURL matches regex @"/h/rest.*\.(php|jsp|jspx|war|sh|py|pl|rb)"
           // Null byte injection
           or RequestURL has "%00"
       )
    | extend
        SourceAddress = SourceIP,
        ThreatIndicator = "Suspicious /h/rest request (possible PHP RFI)",
        tostring_EventOutcome = tostring(EventOutcome)
    | project TimeGenerated, DeviceName, SourceAddress, RequestURL, tostring_EventOutcome, ThreatIndicator
  );
  // Branch 2: Syslog — Zimbra process errors from file inclusion abuse
  let ZimbraSyslogErrors = union isfuzzy=true (
    Syslog
    | where TimeGenerated > ago(1h)
    | where ProcessName has_any ("zimbra", "mailboxd", "zmconfigd", "zmmailboxdmgr")
       and (SyslogMessage has_any ("include(", "require(", "failed to open stream", "No such file or directory")
            and SyslogMessage has_any ("/h/rest", "WebRoot", "zimbraServer"))
    | extend ThreatIndicator = "Zimbra file inclusion error in syslog", DeviceName = Computer
    | project TimeGenerated, DeviceName, ProcessName, SyslogMessage, ThreatIndicator
  );
  // Branch 3: DeviceProcessEvents — Zimbra Java spawning shells (post-exploitation)
  let ZimbraShellSpawn = DeviceProcessEvents
    | where TimeGenerated > ago(1h)
    | where (InitiatingProcessFileName in~ ("java", "java8") or InitiatingProcessFolderPath has_any ("/opt/zimbra/", "/usr/share/zimbra/", "C:\\Program Files\\Zimbra\\"))
       and FileName in~ ("sh", "bash", "curl", "wget", "python", "python3", "perl", "nc", "ncat", "cmd.exe", "powershell.exe")
    | extend ThreatIndicator = "Zimbra Java process spawned shell (post-exploitation)", SourceAddress = ""
    | project TimeGenerated, DeviceName, InitiatingProcessFileName, FileName, ProcessCommandLine, ThreatIndicator;
  // Union all branches
  union isfuzzy=true ZimbraRESTAbuse, ZimbraSyslogErrors, ZimbraShellSpawn
  | sort by TimeGenerated desc

entityMappings:
  - entityType: Host
    fieldMappings:
      - identifier: HostName
        columnName: DeviceName
  - entityType: IP
    fieldMappings:
      - identifier: Address
        columnName: SourceAddress
  - entityType: URL
    fieldMappings:
      - identifier: Url
        columnName: RequestURL

alertDetailsOverride:
  alertDisplayNameFormat: "Zimbra ZCS PHP RFI Exploit Indicator (CVE-2025-68645) on {{DeviceName}}"
  alertDescriptionFormat: "{{ThreatIndicator}} detected on {{DeviceName}}"

customDetails:
  VulnID: "CVE-2025-68645"
  AffectedProduct: "Synacor Zimbra Collaboration Suite"
  KEVAdded: "2026-01-22"
  VulnType: "PHP Remote File Inclusion"

version: 1.0.0
kind: Scheduled
