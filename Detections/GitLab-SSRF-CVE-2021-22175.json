{
  "name": "GitLab Server-Side Request Forgery (SSRF) Exploitation (CVE-2021-22175)",
  "description": "Detects exploitation attempts against GitLab CVE-2021-22175, a Server-Side Request Forgery vulnerability triggered when webhooks to internal networks are enabled. Added to CISA KEV on 2026-02-18. An attacker can exploit this to make GitLab send requests to internal network resources, potentially reaching cloud metadata services (169.254.169.254), internal APIs, or other sensitive infrastructure. This can lead to credential theft, lateral movement, or cloud account takeover. Particularly dangerous in Azure/GCP/AWS environments where the IMDS endpoint is accessible.",
  "severity": "High",
  "tactics": ["InitialAccess", "Discovery", "CredentialAccess"],
  "techniques": ["T1190", "T1580", "T1552"],
  "requiredDataConnectors": ["CommonSecurityLog", "AzureFirewall", "AzureWebApplicationFirewall"],
  "query": "// GitLab SSRF Exploitation Detection (CVE-2021-22175)\n// Detects requests to GitLab webhook endpoints that may be leveraging SSRF\n// Also detects outbound requests from GitLab servers to IMDS or internal ranges\nlet timeframe = 1h;\nlet internal_targets = dynamic(['169.254.169.254', '169.254.0.0', 'metadata.google.internal', '100.100.100.200']);\nlet gitlab_webhook_paths = dynamic(['/hooks', '/projects/', 'hooks/test', 'api/v4/projects']);\n// 1. Inbound exploitation attempts to GitLab webhook endpoint\nlet InboundSSRF = CommonSecurityLog\n| where TimeGenerated >= ago(timeframe)\n| where RequestURL has_any (gitlab_webhook_paths)\n  and (DeviceProduct has_any ('GitLab', 'nginx', 'apache') or DestinationPort in (80, 443, 8080))\n| where RequestMethod == 'POST'\n| extend SSRFPayloadSuspicion = iff(\n    AdditionalExtensions has_any ('169.254', 'metadata', 'localhost', '127.0.0.1', '0.0.0.0', 'internal'),\n    'High', 'Medium'\n  )\n| project TimeGenerated, SourceIP, DestinationIP, DestinationHostName, RequestURL, RequestMethod, SSRFPayloadSuspicion, DeviceVendor, DeviceProduct;\n// 2. Outbound IMDS/metadata requests from GitLab servers (SSRF callback)\nlet OutboundIMDS = CommonSecurityLog\n| where TimeGenerated >= ago(timeframe)\n| where DestinationIP has_any (internal_targets)\n   or RequestURL has_any (internal_targets)\n| project TimeGenerated, SourceIP, DestinationIP, RequestURL, DeviceVendor, DeviceProduct\n| extend SSRFPayloadSuspicion = 'Critical - IMDS Access Attempted';\n// 3. Azure Firewall - GitLab to internal network traffic\nlet AzureFWGitLabSSRF = AzureDiagnostics\n| where TimeGenerated >= ago(timeframe)\n| where Category in ('AzureFirewallApplicationRule', 'AzureFirewallNetworkRule')\n| where dstIp_s has_any (internal_targets) or requestUrl_s has_any (internal_targets)\n| project TimeGenerated, SourceIP = srcIp_s, DestinationIP = dstIp_s, RequestURL = requestUrl_s, Action = action_s\n| extend SSRFPayloadSuspicion = 'Critical - IMDS/Internal Access via Firewall';\nInboundSSRF\n| union OutboundIMDS\n| union AzureFWGitLabSSRF\n| summarize FirstSeen = min(TimeGenerated), LastSeen = max(TimeGenerated), Count = count(), URLs = make_set(RequestURL, 5)\n    by SourceIP, DestinationIP, SSRFPayloadSuspicion\n| sort by Count desc",
  "queryFrequency": "PT1H",
  "queryPeriod": "PT1H",
  "triggerOperator": "GreaterThan",
  "triggerThreshold": 0,
  "entityMappings": [
    {
      "entityType": "IP",
      "fieldMappings": [{ "identifier": "Address", "columnName": "SourceIP" }]
    }
  ],
  "incidentConfiguration": {
    "createIncident": true,
    "groupingConfiguration": {
      "enabled": true,
      "reopenClosedIncident": false,
      "lookbackDuration": "PT5H",
      "matchingMethod": "Selected",
      "groupByEntities": ["IP"]
    }
  },
  "source": "https://www.cisa.gov/known-exploited-vulnerabilities-catalog",
  "references": [
    "https://nvd.nist.gov/vuln/detail/CVE-2021-22175",
    "https://about.gitlab.com/releases/2021/02/11/critical-security-release-gitlab-13-8-4-released/"
  ],
  "created": "2026-02-20",
  "version": "1.0.0"
}
