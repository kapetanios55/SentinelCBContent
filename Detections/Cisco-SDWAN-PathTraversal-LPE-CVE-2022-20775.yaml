id: 4b902f70-f97a-4d79-b00f-d47a3c223e83
name: Cisco SD-WAN CLI Path Traversal Privilege Escalation (CVE-2022-20775)
description: |
  Detects indicators of exploitation of CVE-2022-20775, a path traversal vulnerability in
  Cisco SD-WAN CLI application controls. An authenticated local attacker can exploit improper
  access controls on CLI commands to traverse directory boundaries and gain elevated root
  privileges. A successful exploit allows arbitrary command execution as root.

  CISA Emergency Directive 26-03 mandates immediate remediation. Due date: 2026-02-27.

  This vulnerability is post-authentication and typically indicates an insider threat,
  compromised SD-WAN management account, or lateral movement within network infrastructure.

  Detection surfaces:
  - CommonSecurityLog: Cisco SD-WAN syslog events with privilege escalation or unusual CLI patterns
  - Syslog: vShell/vdaemon process log entries with path traversal indicators
  - DeviceProcessEvents: If MDE agents monitor the SD-WAN management host

  Reference: https://www.cisco.com/c/en/us/support/docs/csa/cisco-sa-sd-wan-priv-E6e8tEdF.html
severity: High
requiredDataConnectors:
  - connectorId: CommonSecurityLog
    dataTypes:
      - CommonSecurityLog
  - connectorId: Syslog
    dataTypes:
      - Syslog
  - connectorId: MicrosoftDefenderAdvancedThreatProtection
    dataTypes:
      - DeviceProcessEvents
queryFrequency: 1h
queryPeriod: 1h
triggerOperator: gt
triggerThreshold: 0
tactics:
  - PrivilegeEscalation
  - LateralMovement
relevantTechniques:
  - T1068
  - T1021
  - T1059
query: |
  union isfuzzy=true
  (
      CommonSecurityLog
      | where DeviceVendor has_any ("Cisco")
      | where DeviceProduct has_any ("SD-WAN", "vManage", "vEdge", "cEdge", "SDWAN")
      | where Activity has_any ("privilege", "escalation", "root", "vshell", "cli", "exec", "shell")
          or Message has_any ("privilege escalation", "root access", "path traversal",
                               "../", "/etc/", "vshell", "sudo", "root shell",
                               "unauthorized command", "access violation", "cli access")
      | extend AccountName = SourceUserName
      | extend TargetDevice = DeviceAddress
      | project TimeGenerated, DeviceVendor, DeviceProduct, Activity, Message,
                SourceIP, DestinationIP, AccountName, TargetDevice,
                AdditionalExtensions, LogSeverity, EventOutcome
  ),
  (
      Syslog
      | where ProcessName has_any ("vshell", "vdaemon", "vmanage", "sdwan", "cli")
      | where SyslogMessage has_any ("privilege escalation", "root", "../", "/etc/",
                                      "path traversal", "unauthorized", "vshell", "sudo",
                                      "access violation", "root shell", "setuid")
      | project TimeGenerated, Computer, ProcessName, SyslogMessage, HostIP, Facility, SeverityLevel
  ),
  (
      DeviceProcessEvents
      | where FileName has_any ("vshell", "sudo", "su", "bash", "sh")
          or ProcessCommandLine has_any ("../", "/etc/shadow", "/etc/passwd", "chmod +s",
                                          "path traversal", "vshell", "sd-wan")
      | where InitiatingProcessFileName has_any ("vmanage", "vdaemon", "sdwan", "vshell")
      | extend AccountName = AccountName
      | project TimeGenerated, DeviceName, FileName, ProcessCommandLine,
                InitiatingProcessFileName, InitiatingProcessCommandLine, AccountName,
                InitiatingProcessAccountName
  )
  | extend CVE = "CVE-2022-20775"
  | extend DetectionContext = "Cisco SD-WAN CLI Path Traversal LPE â€“ CISA ED-26-03"
version: 1.0.0
kind: Scheduled
