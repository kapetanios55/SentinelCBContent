id: c8d4e2f3-a5b6-7890-cdef-012345678902
name: BeyondTrust Remote Support / PRA OS Command Injection (CVE-2026-1731)
description: |
  Detects exploitation of CVE-2026-1731, an unauthenticated OS command injection vulnerability
  in BeyondTrust Remote Support (RS) and Privileged Remote Access (PRA). This critical flaw
  requires no authentication or user interaction and allows a remote attacker to execute
  operating system commands as the site user, potentially leading to full system compromise,
  data exfiltration, and service disruption.

  CVE-2026-1731 has been linked to Known Ransomware Campaign Use per CISA KEV (added 2026-02-13,
  due 2026-02-16 — PAST DUE). Any unpatched BeyondTrust RS/PRA instances should be treated as
  potentially compromised.

  References:
    - https://www.beyondtrust.com/trust-center/security-advisories/bt26-02
    - https://nvd.nist.gov/vuln/detail/CVE-2026-1731
    - https://www.cisa.gov/known-exploited-vulnerabilities-catalog

severity: High
status: Available
requiredDataConnectors:
  - connectorId: MicrosoftDefenderForEndpoint
    datatypes:
      - DeviceProcessEvents
      - DeviceNetworkEvents
      - DeviceEvents
  - connectorId: CEF
    datatypes:
      - CommonSecurityLog
  - connectorId: Syslog
    datatypes:
      - Syslog
queryFrequency: 1h
queryPeriod: 1h
triggerOperator: gt
triggerThreshold: 0
tactics:
  - InitialAccess
  - Execution
  - Persistence
  - Exfiltration
relevantTechniques:
  - T1190
  - T1059
  - T1048
query: |
  // -----------------------------------------------------------------------
  // Query 1: Suspicious child processes spawned by BeyondTrust processes
  // A command injection exploit would cause btanswer, scserver, or bomgar-scc
  // to launch unexpected shell processes (cmd, sh, bash, powershell, etc.)
  // -----------------------------------------------------------------------
  let BeyondTrustChildProcs = DeviceProcessEvents
    | where TimeGenerated > ago(1h)
    | where InitiatingProcessFileName has_any (
        "btanswer", "scserver", "bomgar-scc", "bomgar-rdp",
        "RemoteSupportJumpClient", "pra-server", "beyond-trust"
      )
    | where FileName has_any (
        "cmd.exe", "powershell.exe", "pwsh.exe", "sh", "bash", "zsh",
        "python.exe", "python3", "perl.exe", "perl", "ruby",
        "curl", "wget", "nc", "ncat", "netcat", "socat", "certutil.exe",
        "wscript.exe", "cscript.exe", "mshta.exe", "rundll32.exe",
        "regsvr32.exe", "bitsadmin.exe", "msiexec.exe"
      )
    | extend AlertDetail = strcat("BeyondTrust process '", InitiatingProcessFileName,
        "' spawned suspicious child process: ", FileName)
    | project TimeGenerated, DeviceName, AccountName, InitiatingProcessFileName,
              FileName, ProcessCommandLine, AlertDetail;
  // -----------------------------------------------------------------------
  // Query 2: BeyondTrust processes making outbound network connections
  // on unusual ports — potential reverse shell or C2 establishment
  // -----------------------------------------------------------------------
  let BeyondTrustOutbound = DeviceNetworkEvents
    | where TimeGenerated > ago(1h)
    | where InitiatingProcessFileName has_any (
        "btanswer", "scserver", "bomgar-scc", "bomgar-rdp",
        "RemoteSupportJumpClient", "pra-server"
      )
    | where ActionType == "ConnectionSuccess"
    | where RemotePort !in (80, 443, 8080, 8443, 4443, 63335)
        // Exclude known BeyondTrust management ports; flag unusual outbound
    | where not (RemoteIPType == "Private" and RemotePort in (389, 636, 88, 445, 3389))
    | extend AlertDetail = strcat("BeyondTrust process '", InitiatingProcessFileName,
        "' made unexpected outbound connection to ", RemoteIP, ":", RemotePort)
    | extend AccountName = InitiatingProcessAccountName
    | project TimeGenerated, DeviceName, AccountName, InitiatingProcessFileName,
              RemoteIP, RemotePort, RemoteUrl, AlertDetail;
  // -----------------------------------------------------------------------
  // Query 3: Web request patterns indicating command injection in BeyondTrust
  // Detects shell metacharacters in inbound requests to BeyondTrust endpoints
  // -----------------------------------------------------------------------
  let BeyondTrustWebAttack = CommonSecurityLog
    | where TimeGenerated > ago(1h)
    | where DeviceProduct has_any ("BeyondTrust", "RemoteSupport", "PRA", "Bomgar")
        or DestinationPort in (443, 8443, 80, 8080)
    | where RequestURL has_any (
        "$(", "`", "||", "&&", ";/bin/", ";/usr/bin", "|bash", "|sh",
        "%24%28", "%60", "%7C%7C", "%26%26"  // URL-encoded variants
      )
    | extend AlertDetail = "Possible command injection attempt against BeyondTrust endpoint"
    | project TimeGenerated, SourceIP, DestinationIP, DestinationPort,
              RequestURL, RequestMethod, AlertDetail;
  // Union all sub-queries
  union BeyondTrustChildProcs, BeyondTrustOutbound, BeyondTrustWebAttack
  | sort by TimeGenerated desc

entityMappings:
  - entityType: Host
    fieldMappings:
      - identifier: FullName
        columnName: DeviceName
  - entityType: IP
    fieldMappings:
      - identifier: Address
        columnName: RemoteIP
  - entityType: Account
    fieldMappings:
      - identifier: Name
        columnName: AccountName

customDetails:
  AlertDetail: AlertDetail

alertDetailsOverride:
  alertDisplayNameFormat: "BeyondTrust CVE-2026-1731 Exploit Indicator: {{AlertDetail}}"
  alertDescriptionFormat: "Potential exploitation of CVE-2026-1731 (OS Command Injection, Known Ransomware). {{AlertDetail}}"

suppressionDuration: 4h
suppressionEnabled: false
incidentConfiguration:
  createIncident: true
  groupingConfiguration:
    enabled: true
    reopenClosedIncident: false
    lookbackDuration: 4h
    matchingMethod: AllEntities
    groupByEntities:
      - Host
      - IP
    groupByAlertDetails: []
    groupByCustomDetails: []

version: 1.0.1
kind: Scheduled
