id: b2c3d4e5-f6a7-8901-bcde-f12345678901
name: Wiper Malware Behavior - Mass File Deletion and Drive Corruption (DynoWiper/Sandworm TTPs)
description: |
  Detects behavior consistent with wiper malware such as DynoWiper, attributed to Russian APT
  Sandworm (APT44), used in attacks against Polish energy companies in December 2025.
  The malware enumerates drives, recursively corrupts files by overwriting with random bytes,
  then deletes files before forcing a system reboot via SeShutdownPrivilege escalation.
  Key IOBs (Indicators of Behavior):
  - High-volume file deletion (EventID 4663 with DELETE access mask)
  - SeShutdownPrivilege escalation (EventID 4703)
  - Forced shutdown commands
  - Mass file modification/deletion in MDE telemetry
  Known IOC SHA256: 835b0d87ed2d49899ab6f9479cddb8b4e03f5aeb2365c50a51f9088dcede68d5
  References:
  - https://www.welivesecurity.com/en/eset-research/dynowiper-update-technical-analysis-attribution/
  - https://cert.pl/uploads/docs/CERT_Polska_Energy_Sector_Incident_Report_2025.pdf
severity: High
status: Available
requiredDataConnectors:
  - connectorId: SecurityEvents
    datatypes:
      - SecurityEvent
  - connectorId: MicrosoftDefenderAdvancedThreatProtection
    datatypes:
      - DeviceFileEvents
      - DeviceProcessEvents
queryFrequency: 1h
queryPeriod: 1h
triggerOperator: gt
triggerThreshold: 0
tactics:
  - Impact
  - DefenseEvasion
  - PrivilegeEscalation
relevantTechniques:
  - T1485
  - T1529
  - T1134
  - T1083
  - T1222
query: |
  let timeframe = 1h;
  let mass_delete_threshold = 100;
  // 1. Mass File Deletion via Security Event auditing
  let MassFileDeletion = SecurityEvent
  | where TimeGenerated >= ago(timeframe)
  | where EventID == 4663
  | where ObjectType == 'File'
  | where AccessMask has '0x10000'
  | summarize DeleteCount = count(), Files = make_set(ObjectName, 20), FirstSeen = min(TimeGenerated)
      by Computer, Account, ProcessName
  | where DeleteCount >= mass_delete_threshold
  | extend BehaviorType = 'MassFileDeletion', RiskScore = 80;
  // 2. SeShutdownPrivilege Escalation
  let ShutdownPrivEscalation = SecurityEvent
  | where TimeGenerated >= ago(timeframe)
  | where EventID == 4703
  | where PrivilegeList has 'SeShutdownPrivilege'
  | project TimeGenerated, Computer, Account, ProcessName
  | extend BehaviorType = 'ShutdownPrivilegeEnabled', RiskScore = 60;
  // 3. Forced Shutdown Commands
  let ForcedShutdown = SecurityEvent
  | where TimeGenerated >= ago(timeframe)
  | where EventID == 4688
  | where CommandLine has_any ('shutdown /r /f', 'shutdown -r -f')
     or (NewProcessName has 'shutdown.exe' and CommandLine has '/f')
  | project TimeGenerated, Computer, Account, CommandLine, NewProcessName
  | extend BehaviorType = 'ForcedShutdown', RiskScore = 70;
  // 4. MDE - High volume file deletion
  let MDEWiperBehavior = DeviceFileEvents
  | where TimeGenerated >= ago(timeframe)
  | where ActionType in ('FileDeleted', 'FileModified')
  | where not(FolderPath has_any ('system32', 'windows', 'Program Files', 'Temp', 'RecycleBin', '$Recycle.Bin', 'Boot', 'PerfLogs', 'AppData'))
  | summarize FileCount = count(), Files = make_set(FileName, 10), FirstSeen = min(TimeGenerated)
      by DeviceName, InitiatingProcessFileName, InitiatingProcessAccountName
  | where FileCount >= mass_delete_threshold
  | extend BehaviorType = 'MDEMassFileModification', RiskScore = 85;
  // Combine all signals
  MassFileDeletion
  | project TimeGenerated = FirstSeen, Host = Computer, Account, BehaviorType, RiskScore
  | union (ShutdownPrivEscalation | project TimeGenerated, Host = Computer, Account, BehaviorType, RiskScore)
  | union (ForcedShutdown | project TimeGenerated, Host = Computer, Account, BehaviorType, RiskScore)
  | union (MDEWiperBehavior | project TimeGenerated = FirstSeen, Host = DeviceName, Account = InitiatingProcessAccountName, BehaviorType, RiskScore)
  | summarize Behaviors = make_set(BehaviorType), MaxRiskScore = max(RiskScore), FirstSeen = min(TimeGenerated), LastSeen = max(TimeGenerated)
      by Host, Account
  | extend CombinedRisk = iff(array_length(Behaviors) >= 2, MaxRiskScore + 15, MaxRiskScore)
  | where CombinedRisk >= 70
  | sort by CombinedRisk desc
entityMappings:
  - entityType: Host
    fieldMappings:
      - identifier: HostName
        columnName: Host
  - entityType: Account
    fieldMappings:
      - identifier: Name
        columnName: Account
version: 1.0.1
kind: Scheduled
