id: 91790c72-fe13-49a4-98c8-b6b66779dc10
name: Soliton FileZen OS Command Injection (CVE-2026-25108)
description: |
  Detects exploitation of CVE-2026-25108, an OS command injection vulnerability in Soliton
  Systems K.K FileZen file transfer appliance. An authenticated user who sends a specially
  crafted HTTP request can execute arbitrary OS commands on the underlying server.

  FileZen is a file transfer appliance widely deployed in Japanese enterprises and government
  agencies. Successful exploitation could lead to full system compromise, data exfiltration
  from stored files, and lateral movement within the network.

  Added to CISA KEV on 2026-02-24 (due 2026-03-17).

  References:
    - https://www.cisa.gov/known-exploited-vulnerabilities-catalog
    - https://www.cve.org/CVERecord?id=CVE-2026-25108
    - https://nvd.nist.gov/vuln/detail/CVE-2026-25108

severity: High
status: Available
requiredDataConnectors:
  - connectorId: MicrosoftDefenderForEndpoint
    datatypes:
      - DeviceProcessEvents
      - DeviceNetworkEvents
  - connectorId: CEF
    datatypes:
      - CommonSecurityLog
  - connectorId: Syslog
    datatypes:
      - Syslog
queryFrequency: 1h
queryPeriod: 1h
triggerOperator: gt
triggerThreshold: 0
tactics:
  - InitialAccess
  - Execution
  - Exfiltration
relevantTechniques:
  - T1190
  - T1059
  - T1048
query: |
  // -----------------------------------------------------------------------
  // Query 1: Suspicious child processes spawned by FileZen web/app processes
  // CVE-2026-25108 is triggered via an authenticated HTTP request; a successful
  // exploit would cause the FileZen web application process (typically Apache,
  // Tomcat, or a custom Java process) to spawn a shell.
  // -----------------------------------------------------------------------
  let FileZenChildProcs = DeviceProcessEvents
    | where TimeGenerated > ago(1h)
    | where InitiatingProcessFileName has_any (
        "filezen", "fz-server", "apache2", "httpd", "java",
        "tomcat", "catalina.sh", "nginx"
      )
    | where FileName has_any (
        "sh", "bash", "zsh", "ksh", "dash",
        "cmd.exe", "powershell.exe", "pwsh.exe",
        "python", "python3", "perl", "ruby", "php",
        "curl", "wget", "nc", "ncat", "netcat", "socat",
        "id", "whoami", "uname", "cat", "ls"
      )
    | where ProcessCommandLine has_any (
        "$(", "`", "||", "&&", ";/bin", ";/usr/bin",
        "/etc/passwd", "/etc/shadow", "wget ", "curl ",
        "nc -e", "bash -i", "python -c", "perl -e"
      )
    | extend AlertDetail = strcat("FileZen process '", InitiatingProcessFileName,
        "' spawned suspicious child process: ", FileName,
        " — potential CVE-2026-25108 exploitation")
    | project TimeGenerated, DeviceName, AccountName, InitiatingProcessFileName,
              FileName, ProcessCommandLine, AlertDetail;
  // -----------------------------------------------------------------------
  // Query 2: HTTP requests to FileZen with command injection patterns
  // Detects shell metacharacters and common injection payloads in inbound
  // requests reaching a CEF-capable WAF, proxy, or F5/Palo in front of FileZen.
  // -----------------------------------------------------------------------
  let FileZenWebAttack = CommonSecurityLog
    | where TimeGenerated > ago(1h)
    // Scope to FileZen-related devices or generic web traffic to appliance IPs
    | where DeviceProduct has_any ("FileZen", "Soliton") 
        or (RequestURL has_any ("/filezen/", "/fz/", "/FileZen/"))
    | where RequestURL has_any (
        "$(", "`", "||", "&&", ";/bin/", ";/usr/bin",
        "|bash", "|sh", "|id", "|whoami",
        "%24%28",   // URL-encoded $(
        "%60",      // URL-encoded `
        "%7C%7C",   // URL-encoded ||
        "%26%26",   // URL-encoded &&
        "wget+", "curl+", "nc+-e"
      )
    | extend AlertDetail = strcat(
        "Possible CVE-2026-25108 command injection payload in request to FileZen from ",
        SourceIP)
    | extend AccountName = DestinationUserName
    | project TimeGenerated, SourceIP, DestinationIP, DestinationPort,
              RequestURL, RequestMethod, EventOutcome, AccountName, AlertDetail;
  // -----------------------------------------------------------------------
  // Query 3: Outbound connections from FileZen server processes
  // Post-exploitation reverse shells or data exfiltration channels.
  // -----------------------------------------------------------------------
  let FileZenOutbound = DeviceNetworkEvents
    | where TimeGenerated > ago(1h)
    | where InitiatingProcessFileName has_any (
        "filezen", "fz-server", "apache2", "httpd", "java", "tomcat"
      )
    | where ActionType == "ConnectionSuccess"
    // Flag connections to non-standard ports (not 80/443/8080/8443) or to internet IPs
    | where RemoteIPType != "Private"
        and RemotePort !in (80, 443, 8080, 8443)
    | extend AlertDetail = strcat(
        "FileZen process '", InitiatingProcessFileName,
        "' made unexpected outbound connection to ", RemoteIP, ":", RemotePort,
        " — potential post-exploitation C2 or exfiltration")
    | extend AccountName = InitiatingProcessAccountName
    | project TimeGenerated, DeviceName, AccountName, InitiatingProcessFileName,
              RemoteIP, RemotePort, RemoteUrl, AlertDetail;
  // -----------------------------------------------------------------------
  // Query 4: Syslog — OS command execution evidence on FileZen hosts
  // Covers Linux-based FileZen appliances forwarding syslog.
  // -----------------------------------------------------------------------
  let FileZenSyslog = Syslog
    | where TimeGenerated > ago(1h)
    | where Computer has_any ("filezen", "fz-")
        or ProcessName has_any ("sshd", "su", "sudo", "bash", "sh")
    | where SyslogMessage has_any (
        "filezen", "fz-server",
        "sudo: ",
        "COMMAND=/bin/", "COMMAND=/usr/bin/",
        "Authentication failure",
        "session opened for user root"
      )
    | extend AlertDetail = strcat(
        "FileZen host syslog alert: ", SyslogMessage)
    | project TimeGenerated, Computer, ProcessName, SyslogMessage, AlertDetail;
  // Union all sub-queries
  union FileZenChildProcs, FileZenWebAttack, FileZenOutbound, FileZenSyslog
  | extend AccountName = iif(isempty(AccountName), "N/A", AccountName)
  | sort by TimeGenerated desc

entityMappings:
  - entityType: Host
    fieldMappings:
      - identifier: FullName
        columnName: DeviceName
  - entityType: IP
    fieldMappings:
      - identifier: Address
        columnName: RemoteIP
  - entityType: Account
    fieldMappings:
      - identifier: Name
        columnName: AccountName

customDetails:
  AlertDetail: AlertDetail

alertDetailsOverride:
  alertDisplayNameFormat: "Soliton FileZen CVE-2026-25108 Exploit Indicator: {{AlertDetail}}"
  alertDescriptionFormat: "Potential exploitation of CVE-2026-25108 (OS Command Injection in Soliton FileZen). {{AlertDetail}}"

suppressionDuration: 4h
suppressionEnabled: false
incidentConfiguration:
  createIncident: true
  groupingConfiguration:
    enabled: true
    reopenClosedIncident: false
    lookbackDuration: 4h
    matchingMethod: AllEntities
    groupByEntities:
      - Host
      - IP
    groupByAlertDetails: []
    groupByCustomDetails: []

version: 1.0.0
kind: Scheduled
