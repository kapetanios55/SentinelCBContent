id: 39aeafc1-db2a-4c84-a476-65f4b5e1a858
name: SolarWinds Web Help Desk Deserialization RCE (CVE-2025-40551)
description: |
  Detects exploitation of CVE-2025-40551, a critical unauthenticated Java deserialization
  vulnerability in SolarWinds Web Help Desk (WHD). Successful exploitation allows a remote
  unauthenticated attacker to execute arbitrary commands on the underlying server.

  WHD is a high-value target due to its privileged access to asset inventories, IT credentials,
  and ticketing workflows. This vulnerability complements CVE-2025-40536 (auth bypass, already
  covered) and enables direct RCE without requiring the auth bypass step.

  Detection focuses on three post-exploitation indicators:
  - HTTP POST requests to WHD Java/Tomcat endpoints with oversized or typed payloads
    consistent with Java serialized object delivery
  - WHD Java/Tomcat process spawning interactive shells or download utilities
  - Outbound network connections from the WHD Java process to non-SolarWinds destinations

  CVE-2025-40551 was added to the CISA KEV catalog on 2026-02-03 (due 2026-02-06 — past due).
  No authentication required. CVSS: Critical.

  References:
    - https://www.solarwinds.com/trust-center/security-advisories/cve-2025-40551
    - https://nvd.nist.gov/vuln/detail/CVE-2025-40551
    - https://www.cisa.gov/known-exploited-vulnerabilities-catalog

severity: High
status: Available
requiredDataConnectors:
  - connectorId: CEF
    datatypes:
      - CommonSecurityLog
  - connectorId: MicrosoftDefenderForEndpoint
    datatypes:
      - DeviceProcessEvents
      - DeviceNetworkEvents
queryFrequency: 1h
queryPeriod: 1h
triggerOperator: gt
triggerThreshold: 0
tactics:
  - InitialAccess
  - Execution
relevantTechniques:
  - T1190
  - T1059
query: |
  // -----------------------------------------------------------------------
  // Query 1: HTTP POST to WHD endpoints consistent with Java deserialization
  // Serialized Java objects have large payload sizes and specific content types.
  // Also flag 500 errors (deserialization failures from partial/broken payloads).
  // -----------------------------------------------------------------------
  let WHD_DeserialPost = union isfuzzy=true (
    CommonSecurityLog
    | where TimeGenerated > ago(1h)
    | where RequestMethod == "POST"
    | where RequestURL has_any (
        "/helpdesk/WebObjects/Helpdesk.woa",
        "/helpdesk/api",
        "/api/v1/",
        "/WebHelpDesk/"
      )
    // Large serialized Java payloads or explicit serialization content types
    | where AdditionalExtensions has_any (
          "application/x-java-serialized-object",
          "application/octet-stream",
          "java.rmi"
      )
      or toint(RequestSize) > 65536  // 64KB+ POST body — unusual for WHD API calls
      or tostring(EventOutcome) == "500"  // Server error often indicates deserialization attempt
    | extend ResponseCode = tostring(EventOutcome)
    | extend AlertDetail = strcat(
        "Possible WHD deserialization POST from ", SourceIP,
        " to ", RequestURL, " (HTTP ", ResponseCode, ")"
      )
    | project TimeGenerated, SourceIP, DestinationIP, RequestURL,
              RequestMethod, ResponseCode, AlertDetail
  );
  // -----------------------------------------------------------------------
  // Query 2: WHD Java/Tomcat process spawning shells or download utilities
  // Successful RCE via deserialization typically manifests as cmd/powershell
  // launched as a child of the Java process running the WHD application.
  // -----------------------------------------------------------------------
  let WHD_ShellSpawn = DeviceProcessEvents
    | where TimeGenerated > ago(1h)
    | where InitiatingProcessFileName in~ ("java.exe", "javaw.exe", "tomcat.exe", "tomcat9.exe")
    | where InitiatingProcessCommandLine has_any (
        "helpdesk", "whd", "solarwinds", "WebHelpDesk", "Helpdesk.woa"
      )
    | where FileName has_any (
        "cmd.exe", "powershell.exe", "pwsh.exe",
        "sh", "bash", "dash",
        "wget.exe", "curl.exe", "certutil.exe",
        "bitsadmin.exe", "mshta.exe", "wscript.exe", "cscript.exe",
        "net.exe", "net1.exe", "whoami.exe"
      )
    | extend AlertDetail = strcat(
        "SolarWinds WHD Java process spawned ", FileName,
        " on ", DeviceName, " — possible deserialization RCE"
      )
    | project TimeGenerated, DeviceName, AccountName, InitiatingProcessFileName,
              InitiatingProcessCommandLine, FileName, ProcessCommandLine, AlertDetail;
  // -----------------------------------------------------------------------
  // Query 3: Outbound connections from WHD Java process to external IPs
  // Post-exploitation C2 callback: java.exe connecting out to attacker infrastructure.
  // -----------------------------------------------------------------------
  let WHD_C2Callback = DeviceNetworkEvents
    | where TimeGenerated > ago(1h)
    | where InitiatingProcessFileName in~ ("java.exe", "javaw.exe", "tomcat.exe", "tomcat9.exe")
    | where InitiatingProcessCommandLine has_any (
        "helpdesk", "whd", "solarwinds", "WebHelpDesk"
      )
    | where RemoteIPType !in ("Private", "Loopback")
    | where not(RemoteUrl has_any (
        "solarwinds.com", "swid.solarwinds.com",
        "windowsupdate.com", "microsoft.com"
      ))
    | extend AccountName = InitiatingProcessAccountName
    | extend AlertDetail = strcat(
        "WHD Java process making external connection to ",
        RemoteIP, ":", RemotePort,
        " (", coalesce(RemoteUrl, "no hostname"), ") on ", DeviceName
      )
    | project TimeGenerated, DeviceName, AccountName, InitiatingProcessFileName,
              RemoteIP, RemotePort, RemoteUrl, AlertDetail;
  // Combine all indicators
  union WHD_DeserialPost, WHD_ShellSpawn, WHD_C2Callback
  | sort by TimeGenerated desc

entityMappings:
  - entityType: Host
    fieldMappings:
      - identifier: FullName
        columnName: DeviceName
  - entityType: IP
    fieldMappings:
      - identifier: Address
        columnName: SourceIP
  - entityType: IP
    fieldMappings:
      - identifier: Address
        columnName: RemoteIP
  - entityType: Account
    fieldMappings:
      - identifier: Name
        columnName: AccountName

customDetails:
  AlertDetail: AlertDetail

alertDetailsOverride:
  alertDisplayNameFormat: "SolarWinds WHD CVE-2025-40551 RCE Indicator: {{AlertDetail}}"
  alertDescriptionFormat: "Possible exploitation of SolarWinds Web Help Desk unauthenticated deserialization RCE (CVE-2025-40551). {{AlertDetail}}"

suppressionDuration: 4h
suppressionEnabled: false
incidentConfiguration:
  createIncident: true
  groupingConfiguration:
    enabled: true
    reopenClosedIncident: false
    lookbackDuration: 4h
    matchingMethod: AllEntities
    groupByEntities:
      - Host
      - IP
    groupByAlertDetails: []
    groupByCustomDetails: []

version: 1.0.0
kind: Scheduled
