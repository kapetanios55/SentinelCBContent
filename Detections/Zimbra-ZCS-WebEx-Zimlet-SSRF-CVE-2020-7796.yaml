id: a76e2ef4-53d6-4b8e-a31a-1549d5228dcd
name: Zimbra Collaboration Suite WebEx Zimlet SSRF (CVE-2020-7796)
description: |
  Detects exploitation of CVE-2020-7796, a Server-Side Request Forgery (SSRF) vulnerability
  in Synacor Zimbra Collaboration Suite (ZCS) when the Cisco WebEx zimlet is installed and
  the zimlet JSP endpoint is enabled. The vulnerable endpoint is:

      /zimlet/com_zimbra_webex/httpPost.jsp

  An attacker can craft HTTP requests to this endpoint causing the Zimbra server to make
  arbitrary HTTP requests to internal network resources (metadata services, internal APIs,
  cloud provider IMDS endpoints) or external attacker-controlled infrastructure. This
  enables internal network reconnaissance, credential theft from IMDS, and lateral movement.

  CVE-2020-7796 was added to the CISA KEV catalog on 2026-02-17 (due 2026-03-10).
  Organizations running ZCS ≤ 8.8.15 P6 with WebEx zimlet installed are at risk.

  Detection focuses on:
  - HTTP requests targeting the vulnerable zimlet JSP endpoint
  - Requests with SSRF-indicative URL parameters (loopback, RFC-1918, metadata services)
  - Outbound connections from the Zimbra server Java process to unexpected destinations
  - Internal network scanning patterns originating from the Zimbra server

  References:
    - https://wiki.zimbra.com/wiki/Zimbra_Releases/8.8.15/P7
    - https://nvd.nist.gov/vuln/detail/CVE-2020-7796
    - https://www.cisa.gov/known-exploited-vulnerabilities-catalog

severity: High
status: Available
requiredDataConnectors:
  - connectorId: CEF
    datatypes:
      - CommonSecurityLog
  - connectorId: MicrosoftDefenderForEndpoint
    datatypes:
      - DeviceNetworkEvents
      - DeviceProcessEvents
queryFrequency: 1h
queryPeriod: 1h
triggerOperator: gt
triggerThreshold: 0
tactics:
  - InitialAccess
  - Discovery
relevantTechniques:
  - T1190
  - T1046
query: |
  // -----------------------------------------------------------------------
  // Query 1: Direct requests to the vulnerable WebEx zimlet JSP endpoint
  // Flag ALL access to this path — it should be disabled unless WebEx zimlet
  // is specifically needed. SSRF parameters include url=, target=, host=.
  // -----------------------------------------------------------------------
  let Zimbra_VulnEndpoint = union isfuzzy=true (
    CommonSecurityLog
    | where TimeGenerated > ago(1h)
    | where RequestURL has "/zimlet/com_zimbra_webex/httpPost.jsp"
    // SSRF indicators in the query string or request body
    | extend HasSSRFPayload = RequestURL has_any (
        "169.254.169.254",  // AWS/Azure IMDS
        "metadata.google",  // GCP IMDS
        "localhost", "127.0.0.", "0.0.0.0",
        "10.", "172.16.", "192.168.",  // RFC-1918
        "file://", "dict://", "gopher://", "ftp://"  // unusual schemes
      )
    | extend ResponseCode = tostring(EventOutcome)
    | extend AlertDetail = strcat(
        "Zimbra WebEx zimlet SSRF endpoint accessed from ", SourceIP,
        ": ", RequestURL,
        iff(HasSSRFPayload, " [SSRF payload detected]", " [no payload indicator]")
      )
    | project TimeGenerated, SourceIP, DestinationIP, RequestURL,
              RequestMethod, ResponseCode, HasSSRFPayload, AlertDetail
  );
  // -----------------------------------------------------------------------
  // Query 2: Zimbra server Java process making outbound connections
  // A successful SSRF causes the Zimbra server itself to make HTTP requests.
  // Flag connections from java.exe (Zimbra/Jetty) to unusual destinations.
  // -----------------------------------------------------------------------
  let Zimbra_OutboundSSRF = DeviceNetworkEvents
    | where TimeGenerated > ago(1h)
    | where InitiatingProcessFileName in~ ("java.exe", "javaw.exe")
    | where InitiatingProcessCommandLine has_any (
        "zimbra", "ZCS", "mailboxd", "zimlet"
      )
    | where RemotePort in (80, 443, 8080, 8443, 8888, 9200, 2379, 6443)
    | where RemoteIPType != "Loopback"
    // Flag connections to metadata services or unusual internal targets
    | extend IsMDSSRF = RemoteIP in ("169.254.169.254", "fd00:ec2::254")
    | extend IsInternalSSRF = ipv4_is_private(RemoteIP)
    | extend IsExternalUnexpected = not(ipv4_is_private(RemoteIP))
        and not(RemoteUrl has_any ("zimbra.com", "microsoft.com", "windowsupdate.com"))
    | where IsMDSSRF or IsInternalSSRF or IsExternalUnexpected
    | extend AccountName = InitiatingProcessAccountName
    | extend AlertDetail = strcat(
        "Zimbra Java process outbound to ", RemoteIP, ":", RemotePort,
        iff(IsMDSSRF, " [METADATA SERVICE — CRITICAL]",
        iff(IsInternalSSRF, " [internal network]", " [unexpected external]")),
        " on ", DeviceName
      )
    | project TimeGenerated, DeviceName, AccountName, InitiatingProcessFileName,
              RemoteIP, RemotePort, RemoteUrl, IsMDSSRF, IsInternalSSRF, AlertDetail;
  // -----------------------------------------------------------------------
  // Query 3: Internal network scanning from Zimbra server
  // SSRF-driven recon: multiple outbound connections to different internal IPs
  // in a short window from the Zimbra Java process.
  // -----------------------------------------------------------------------
  let Zimbra_InternalScan = DeviceNetworkEvents
    | where TimeGenerated > ago(1h)
    | where InitiatingProcessFileName in~ ("java.exe", "javaw.exe")
    | where InitiatingProcessCommandLine has_any ("zimbra", "ZCS", "mailboxd")
    | where ipv4_is_private(RemoteIP)
    | summarize
        UniqueInternalIPs = dcount(RemoteIP),
        Ports = make_set(RemotePort),
        SampleIPs = make_list(RemoteIP, 5)
        by DeviceName, InitiatingProcessFileName, bin(TimeGenerated, 5m)
    | where UniqueInternalIPs >= 5  // Threshold: 5+ distinct internal IPs in 5 min
    | extend AccountName = ""
    | extend AlertDetail = strcat(
        "Zimbra server scanning ", UniqueInternalIPs,
        " internal IPs — possible SSRF-driven recon on ", DeviceName
      )
    | project TimeGenerated, DeviceName, AccountName, UniqueInternalIPs, Ports, SampleIPs, AlertDetail;
  // Combine all sub-queries
  union Zimbra_VulnEndpoint, Zimbra_OutboundSSRF, Zimbra_InternalScan
  | sort by TimeGenerated desc

entityMappings:
  - entityType: Host
    fieldMappings:
      - identifier: FullName
        columnName: DeviceName
  - entityType: IP
    fieldMappings:
      - identifier: Address
        columnName: SourceIP
  - entityType: IP
    fieldMappings:
      - identifier: Address
        columnName: RemoteIP

customDetails:
  AlertDetail: AlertDetail

alertDetailsOverride:
  alertDisplayNameFormat: "Zimbra ZCS CVE-2020-7796 SSRF Indicator: {{AlertDetail}}"
  alertDescriptionFormat: "Possible exploitation of Zimbra Collaboration Suite WebEx zimlet SSRF (CVE-2020-7796). {{AlertDetail}}"

suppressionDuration: 4h
suppressionEnabled: false
incidentConfiguration:
  createIncident: true
  groupingConfiguration:
    enabled: true
    reopenClosedIncident: false
    lookbackDuration: 4h
    matchingMethod: AllEntities
    groupByEntities:
      - Host
      - IP
    groupByAlertDetails: []
    groupByCustomDetails: []

version: 1.0.0
kind: Scheduled
