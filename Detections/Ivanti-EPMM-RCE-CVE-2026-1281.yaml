id: b9d14c32-5a7f-4e89-a231-ivanti1281rce
name: Ivanti Endpoint Manager Mobile (EPMM) Unauthenticated Remote Code Execution (CVE-2026-1281)
description: |
  Detects exploitation of CVE-2026-1281, a critical code injection vulnerability in Ivanti
  Endpoint Manager Mobile (EPMM, formerly MobileIron). The vulnerability allows an unauthenticated
  remote attacker to execute arbitrary code on the EPMM server without credentials or user
  interaction. It was actively exploited in the wild and added to the CISA KEV catalog on
  2026-01-29 with a remediation deadline of 2026-02-01.

  Detection logic covers three signals:
  1. Suspicious child process spawning from Ivanti/MobileIron service processes (most reliable).
  2. Unusual outbound connections from Ivanti EPMM processes to non-MDM external infrastructure.
  3. CommonSecurityLog entries from Ivanti EPMM appliances showing exploit-pattern URIs.

  References:
  - https://forums.ivanti.com/s/article/Security-Advisory-Ivanti-Endpoint-Manager-Mobile-EPMM-CVE-2026-1281-CVE-2026-1340
  - https://nvd.nist.gov/vuln/detail/CVE-2026-1281

severity: High

requiredDataConnectors:
  - connectorId: MicrosoftDefenderAdvancedThreatProtection
    dataTypes:
      - DeviceProcessEvents
      - DeviceNetworkEvents
  - connectorId: CommonSecurityLog
    dataTypes:
      - CommonSecurityLog

queryFrequency: 1h
queryPeriod: 1h

triggerOperator: gt
triggerThreshold: 0

tactics:
  - InitialAccess
  - Execution

relevantTechniques:
  - T1190
  - T1059

query: |
  let timeframe = 1h;
  // Known Ivanti/MobileIron service process names
  let IvantiProcesses = dynamic([
      "mi-server", "mi-server.exe", "ivanti-epmm", "mobileiron",
      "catalina.sh", "java", "mi-log-uploader"
  ]);
  // Shells and interpreters that should never be spawned by MDM services
  let SuspiciousChildren = dynamic([
      "cmd.exe", "powershell.exe", "bash", "sh", "dash", "python",
      "python3", "perl", "ruby", "wget", "curl", "nc", "netcat",
      "ncat", "mshta.exe", "wscript.exe", "cscript.exe"
  ]);
  // Signal 1: Suspicious child process from Ivanti service
  let ProcEvents = union isfuzzy=true (
      DeviceProcessEvents
      | where TimeGenerated >= ago(timeframe)
      | where InitiatingProcessFileName has_any (IvantiProcesses)
          or InitiatingProcessParentFileName has_any (IvantiProcesses)
      | where FileName has_any (SuspiciousChildren)
          or ProcessCommandLine has_any ("whoami", "id", "uname", "ifconfig", "curl", "wget", "chmod +x", "base64 -d")
      | extend AccountName = InitiatingProcessAccountName
      | extend Signal = "SuspiciousChildProcess"
      | project
          TimeGenerated,
          Signal,
          AccountName,
          DeviceName,
          FileName,
          ProcessCommandLine,
          InitiatingProcessFileName,
          InitiatingProcessCommandLine
  );
  // Signal 2: Unusual outbound network connection from Ivanti process
  let NetEvents = union isfuzzy=true (
      DeviceNetworkEvents
      | where TimeGenerated >= ago(timeframe)
      | where InitiatingProcessFileName has_any (IvantiProcesses)
      | where RemoteIPType !in ("Private", "Loopback", "LinkLocal")
      | where RemotePort !in (443, 8443, 9090, 80, 8080)  // Exclude standard MDM/HTTPS ports
      | extend AccountName = InitiatingProcessAccountName
      | extend Signal = "UnusualOutboundConnection"
      | project
          TimeGenerated,
          Signal,
          AccountName,
          DeviceName,
          RemoteIP,
          RemotePort,
          RemoteUrl,
          InitiatingProcessFileName,
          InitiatingProcessCommandLine
  );
  // Signal 3: CommonSecurityLog exploit URI patterns for EPMM
  let CSLEvents = union isfuzzy=true (
      CommonSecurityLog
      | where TimeGenerated >= ago(timeframe)
      | where DeviceVendor has_any ("Ivanti", "MobileIron")
          or DeviceProduct has_any ("EPMM", "MobileIron", "Core")
      | where RequestURL has_any (
          "/mifs/aad/api/v2/authorized/",
          "/api/v2/featurePhone/",
          "/mifs/j_spring_security_check",
          "../../",
          "%2e%2e",
          "/bin/sh",
          "/cmd"
      )
      | extend AccountName = SourceUserName
      | extend Signal = "ExploitURIPattern"
      | project
          TimeGenerated,
          Signal,
          AccountName,
          DeviceName,
          SourceIP,
          RequestURL,
          EventOutcome,
          Message
  );
  // Union all signals
  union ProcEvents, NetEvents, CSLEvents
  | order by TimeGenerated desc

version: 1.0.0
kind: Scheduled
