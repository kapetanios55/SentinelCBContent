id: b54ef20f-ecc2-4930-a9ca-a0e953194cdb
name: VMware vCenter Server DCERPC Out-of-Bounds Write RCE (CVE-2024-37079)
description: |
  Detects exploitation attempts against CVE-2024-37079, an out-of-bounds write vulnerability
  in Broadcom VMware vCenter Server's DCERPC protocol implementation. A malicious actor with
  network access to vCenter can send specially crafted DCERPC packets to trigger heap corruption
  and achieve unauthenticated remote code execution.

  CISA KEV added: 2026-01-23. Due: 2026-02-13.

  Detection approach:
  1. Syslog/CommonSecurityLog: Unusual VMware vCenter process crashes or unexpected child spawning
  2. Network events: Unexpected outbound connections from vCenter management IPs (post-exploitation)
  3. SecurityEvent: Privilege escalation events on systems hosting vCenter
  4. DeviceProcessEvents: vCenter-related processes (vpxd, vmware-vpxd) spawning shells

severity: High
status: Available
requiredDataConnectors:
  - connectorId: Syslog
    dataTypes:
      - Syslog
  - connectorId: MicrosoftDefenderAdvancedThreatProtection
    dataTypes:
      - DeviceProcessEvents
      - DeviceNetworkEvents
  - connectorId: SecurityEvents
    dataTypes:
      - SecurityEvent

queryFrequency: 1h
queryPeriod: 1h

triggerOperator: gt
triggerThreshold: 0

tactics:
  - InitialAccess
  - Execution
  - LateralMovement

relevantTechniques:
  - T1190
  - T1059
  - T1021

query: |
  // CVE-2024-37079: VMware vCenter DCERPC RCE detection
  // Branch 1: vCenter processes (vpxd, vsphere-client) spawning unexpected children (MDE)
  let vCenterProcessExec = DeviceProcessEvents
    | where TimeGenerated > ago(1h)
    | where InitiatingProcessFileName in~ ("vpxd", "vmware-vpxd", "vsphere-ui", "rhttpproxy", "vmdird", "vpostgres")
       or InitiatingProcessFolderPath has_any ("/usr/lib/vmware-vpx/", "/usr/lib/vmware-vsphere-ui/", "C:\\Program Files\\VMware\\vCenter Server\\")
    | where FileName in~ ("sh", "bash", "python", "python3", "perl", "cmd.exe", "powershell.exe", "wget", "curl", "nc", "ncat")
       or ProcessCommandLine has_any ("wget", "curl", "/tmp/", "chmod +x", "base64 -d", "bash -i", "/dev/tcp/")
    | extend ThreatIndicator = "vCenter process spawned unexpected shell/tool"
    | project TimeGenerated, DeviceName, InitiatingProcessFileName, FileName, ProcessCommandLine, InitiatingProcessAccountName, ThreatIndicator;
  // Branch 2: Post-exploitation network activity from vCenter hosts (unexpected outbound)
  let vCenterNetworkAnomaly = DeviceNetworkEvents
    | where TimeGenerated > ago(1h)
    | where InitiatingProcessFileName in~ ("vpxd", "vmware-vpxd", "vsphere-ui", "rhttpproxy")
       or InitiatingProcessFolderPath has_any ("/usr/lib/vmware-vpx/", "C:\\Program Files\\VMware\\vCenter Server\\")
    | where RemotePort !in (443, 80, 9443, 5480, 2012, 2014, 2020)  // Exclude known vCenter ports
      and RemoteIPType !in ("Private")  // Flag unexpected external connections
    | extend ThreatIndicator = "vCenter process initiated unexpected external connection"
    | project TimeGenerated, DeviceName, InitiatingProcessFileName, RemoteIP, RemotePort, RemoteUrl, ThreatIndicator;
  // Branch 3: Syslog — vCenter application crashes (DCERPC heap corruption indicator)
  let vCenterSyslogCrash = union isfuzzy=true (
    Syslog
    | where TimeGenerated > ago(1h)
    | where ProcessName has_any ("vpxd", "vmware-vpxd", "vmdird")
       and (SyslogMessage has_any ("core dump", "segmentation fault", "SIGSEGV", "SIGABRT", "heap corruption", "out of bounds")
            or SyslogMessage has "vpxd crashed")
    | extend ThreatIndicator = "vCenter process crash (possible DCERPC heap corruption)", DeviceName = Computer
    | project TimeGenerated, DeviceName, ProcessName, SyslogMessage, ThreatIndicator
  );
  // Union all branches
  union isfuzzy=true vCenterProcessExec, vCenterNetworkAnomaly, vCenterSyslogCrash
  | sort by TimeGenerated desc

entityMappings:
  - entityType: Host
    fieldMappings:
      - identifier: HostName
        columnName: DeviceName
  - entityType: IP
    fieldMappings:
      - identifier: Address
        columnName: RemoteIP
  - entityType: Process
    fieldMappings:
      - identifier: CommandLine
        columnName: ProcessCommandLine

alertDetailsOverride:
  alertDisplayNameFormat: "VMware vCenter DCERPC Exploit Indicator (CVE-2024-37079) on {{DeviceName}}"
  alertDescriptionFormat: "{{ThreatIndicator}} — Process: {{InitiatingProcessFileName}} on {{DeviceName}}"

customDetails:
  VulnID: "CVE-2024-37079"
  CVSSScore: "9.8"
  KEVAdded: "2026-01-23"
  AffectedProduct: "VMware vCenter Server"

version: 1.0.0
kind: Scheduled
