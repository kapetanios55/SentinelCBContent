{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "workbookDisplayName": {
      "type": "string",
      "defaultValue": "CISA KEV Threat Intelligence Dashboard",
      "metadata": {
        "description": "Displays recent CISA Known Exploited Vulnerabilities alongside your environment's exposure and detection coverage."
      }
    },
    "workbookId": {
      "type": "string",
      "defaultValue": "[newGuid()]",
      "metadata": {
        "description": "Unique GUID for this workbook instance. Leave as default to auto-generate."
      }
    },
    "workbookType": {
      "type": "string",
      "defaultValue": "sentinel"
    },
    "workbookSourceId": {
      "type": "string",
      "defaultValue": "[resourceId('microsoft.operationalinsights/workspaces', parameters('workbookWorkspaceName'))]",
      "metadata": {
        "description": "Resource ID of the Log Analytics workspace. Auto-computed from workbookWorkspaceName \u2014 do not override unless you know what you're doing."
      }
    },
    "workbookWorkspaceName": {
      "type": "string",
      "metadata": {
        "description": "Name of the Log Analytics workspace that Microsoft Sentinel is enabled on. This is used to correctly associate the workbook so it appears in the Sentinel Workbooks menu."
      }
    }
  },
  "resources": [
    {
      "type": "microsoft.insights/workbooks",
      "apiVersion": "2022-04-01",
      "name": "[parameters('workbookId')]",
      "location": "[resourceGroup().location]",
      "kind": "shared",
      "properties": {
        "displayName": "[parameters('workbookDisplayName')]",
        "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"crossComponentResources\":[\"{Subscription}\"],\"parameters\":[{\"id\":\"03d5eb75-0590-4d0a-a3ff-bbd2b47b2f8a\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Subscription\",\"label\":\"Subscription\",\"type\":6,\"isRequired\":true,\"typeSettings\":{\"additionalResourceOptions\":[],\"includeAll\":false}},{\"id\":\"c9865235-a8b0-4cf4-ab3a-60ac8bb140fd\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Workspace\",\"label\":\"Workspace\",\"type\":5,\"isRequired\":true,\"query\":\"Resources\\n| where type =~ 'microsoft.operationalinsights/workspaces'\\n| project value = id, label = name, group = resourceGroup\\n| sort by label asc\",\"crossComponentResources\":[\"{Subscription}\"],\"typeSettings\":{\"additionalResourceOptions\":[],\"showDefault\":false},\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},{\"id\":\"2d17c72b-9aa4-4ca1-8f4f-27ad0a7b5f86\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange\",\"label\":\"Time Range\",\"type\":4,\"isRequired\":true,\"typeSettings\":{\"selectableValues\":[{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":86400000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2592000000}],\"allowCustom\":true},\"value\":{\"durationMs\":604800000}}],\"style\":\"above\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"ParameterSelector\"},{\"type\":1,\"content\":{\"json\":\"# \\ud83d\\udee1\\ufe0f CISA KEV Threat Intelligence Dashboard\\n\\n**Generated by ClawdBot** | Updated: 2026-02-20\\n\\nThis workbook tracks recent CISA Known Exploited Vulnerabilities (KEV) and maps them to your Microsoft Sentinel environment's detection coverage. Use this to prioritise patching, validate analytic rule coverage, and spot exploitation attempts.\"},\"name\":\"Header\"},{\"type\":1,\"content\":{\"json\":\"## \\ud83d\\udccb Recent KEV Additions (Feb 2026)\\n\\n| CVE | Product | Vulnerability | Date Added | Due Date | Ransomware? |\\n|-----|---------|---------------|-----------|----------|-------------|\\n| CVE-2025-68461 | RoundCube Webmail | XSS via SVG animate tag | 2026-02-20 | 2026-03-13 | Unknown |\\n| CVE-2025-49113 | RoundCube Webmail | Deserialization RCE via _from param | 2026-02-20 | 2026-03-13 | Unknown |\\n| CVE-2026-22769 | Dell RecoverPoint VMs | Hard-coded credentials / RCE | 2026-02-18 | 2026-02-21 \\u26a0\\ufe0f | Unknown |\\n| CVE-2021-22175 | GitLab | SSRF via webhooks | 2026-02-18 | 2026-03-11 | Unknown |\\n| CVE-2026-2441 | Google Chromium | CSS Use-After-Free / Heap Corruption | 2026-02-17 | 2026-03-10 | Unknown |\\n\\n> \\u26a0\\ufe0f Dell RecoverPoint due date is **2026-02-21** \\u2014 patch immediately!\"},\"name\":\"KEVTable\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"// Detection hits related to RoundCube exploitation attempts\\nCommonSecurityLog\\n| where TimeGenerated >= ago(7d)\\n| where RequestURL has_any ('/roundcube', '/webmail', '/rcmail')\\n| where RequestURL has_any ('/upload.php', '_from=', 'settings/upload')\\n| summarize Count = count() by bin(TimeGenerated, 1h), SourceIP\\n| render timechart\",\"size\":0,\"title\":\"\\ud83d\\udcca RoundCube Exploitation Attempts (Last 7 Days)\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"timeContextFromParameter\":\"TimeRange\"},\"name\":\"RoundCubeTimeline\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"// Wiper-like behavior: mass file deletion events\\nSecurityEvent\\n| where TimeGenerated >= ago(7d)\\n| where EventID == 4663\\n| where ObjectType == 'File'\\n| where AccessMask has '0x10000'\\n| summarize DeleteCount = count() by Computer, bin(TimeGenerated, 1h)\\n| where DeleteCount >= 50\\n| render timechart\",\"size\":0,\"title\":\"\\ud83d\\udd25 High-Volume File Deletion Events (Wiper Detection - Last 7 Days)\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"timeContextFromParameter\":\"TimeRange\"},\"name\":\"WiperBehavior\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"// GitLab SSRF - outbound requests to IMDS/metadata services\\nCommonSecurityLog\\n| where TimeGenerated >= ago(7d)\\n| where DestinationIP has_any ('169.254.169.254', '169.254.0.0', 'metadata.google.internal', '100.100.100.200')\\n   or RequestURL has_any ('169.254.169.254', 'metadata', 'imds')\\n| summarize Count = count() by SourceIP, DestinationIP, bin(TimeGenerated, 1h)\\n| render barchart\",\"size\":0,\"title\":\"\\u26a0\\ufe0f IMDS/Cloud Metadata Service Access Attempts (SSRF Indicator - Last 7 Days)\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"timeContextFromParameter\":\"TimeRange\"},\"name\":\"SSRFDetection\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"// Sentinel Incidents related to these detections\\nSecurityIncident\\n| where TimeGenerated >= ago(30d)\\n| where Title has_any ('RoundCube', 'Wiper', 'DynoWiper', 'GitLab', 'SSRF', 'CVE-2025-68461', 'CVE-2025-49113', 'CVE-2021-22175')\\n| summarize Count = count() by Title, Severity, Status\\n| sort by Count desc\",\"size\":1,\"title\":\"\\ud83d\\udea8 Related Sentinel Incidents (Last 30 Days)\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"timeContextFromParameter\":\"TimeRange\"},\"name\":\"RelatedIncidents\"},{\"type\":1,\"content\":{\"json\":\"## \\ud83c\\udfaf Threat Spotlight: DynoWiper (Sandworm / APT44)\\n\\n**Campaign:** Russian APT Sandworm attacks on Polish energy sector (December 2025)\\n\\n**Malware:** DynoWiper \\u2014 32-bit Windows wiper executable\\n- Enumerates all fixed/removable drives\\n- Recursively corrupts files with random bytes (Mersenne Twister PRNG, seed 5489)\\n- Deletes all targeted files after corruption\\n- Escalates to SeShutdownPrivilege and forces system reboot\\n- **SHA256:** `835b0d87ed2d49899ab6f9479cddb8b4e03f5aeb2365c50a51f9088dcede68d5`\\n\\n**MITRE ATT&CK:** T1485 (Data Destruction), T1529 (System Shutdown/Reboot), T1134 (Access Token Manipulation), T1083 (File Discovery), T1222 (File Permission Modification)\\n\\n**Recommended Actions:**\\n1. Run the DynoWiper IOC SHA256 hunting query across your MDE estate\\n2. Ensure file integrity monitoring is enabled on critical OT/ICS systems\\n3. Review SeShutdownPrivilege assignments on production servers\\n4. Enable Windows Event 4703 (User Right Adjusted) auditing\"},\"name\":\"ThreatSpotlight\"}],\"styleSettings\":{},\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}",
        "version": "1.0",
        "sourceId": "[parameters('workbookSourceId')]",
        "category": "sentinel"
      }
    }
  ]
}